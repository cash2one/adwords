done_urls = [
"www.bookyogaretreats.com/all/c/short/d/europe",
"www.bookyogaretreats.com/all/d/asia-and-oceania/philippines",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/india/goa",
"www.bookyogaretreats.com/all/c|/budget-retreats/d/asia-and-oceania",
"www.bookyogaretreats.com/all/d/europe/croatia",
"www.bookyogaretreats.com/all/c/budget-retreats/d/the-americas-and-caribbean/usa",
"www.bookyogaretreats.com/all/c/budget-retreats/d/europe/united-kingdom",
"www.bookyogateachertraining.com/all/s/yoga-vinyasa",
"www.bookyogaretreats.com/all/c/holidays/d/europe",
"www.bookyogaretreats.com/all/c/holidays/d/the-americas-and-caribbean/usa/hawaii",
"www.bookyogaretreats.com/all/c/holidays/d/the-americas-and-caribbean/usa/florida",
"www.bookyogaretreats.com/all/s/vinyasa-yoga",
"www.bookyogaretreats.com/all/c/yoga-detox-retreats",
"www.bookyogaretreats.com/all/d/the-americas-and-caribbean/mexico",
"www.bookyogaretreats.com/all/c/short/d/the-americas-and-caribbean/usa/california",
"www.bookyogateachertraining.com/all/d/europe",
"www.bookyogaretreats.com/all/c/budget-retreats/d/asia-and-oceania/indonesia/bali",
"www.bookyogaretreats.com/?arrival_date=2017-02-15&flexible=15",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/indonesia",
"www.bookyogaretreats.com/all/c/yoga-meditation-retreats",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/india",
"www.bookyogaretreats.com/?arrival_date=2017-03-15&flexible=15",
"www.bookyogaretreats.com/all/c/yoga-meditation-retreats/d/the-americas-and-caribbean/usa/florida",
"www.bookyogaretreats.com/all/c/budget-retreats/d/the-americas-and-caribbean",
"www.bookyogaretreats.com/all/c/yoga-surf/d/the-americas-and-caribbean/costa-rica",
"www.bookyogaretreats.com/?arrival_date=2016-05-15&flexible=15",
"www.bookyogateachertraining.com/all/d/asia-and-oceania/thailand",
"www.bookyogaretreats.com/all/c/short",
"www.bookyogaretreats.com/all/c/short/d/the-americas-and-caribbean/usa",
"www.bookyogaretreats.com/all/s/bikram-hot-yoga",
"www.bookyogaretreats.com/all/d/asia-and-oceania/india",
"www.bookyogaretreats.com/?arrival_date=2016-12-15&flexible=15",
"www.bookyogaretreats.com/all/d/asia-and-oceania/india/goa",
"www.bookyogaretreats.com/all/c/budget-retreats/d/asia-and-oceania/thailand",
"www.bookyogaretreats.com/all/c/beach-retreats/d/the-americas-and-caribbean",
"www.bookyogaretreats.com/all/c/yoga-surf",
"www.bookyogaretreats.com/all/c/budget-retreats",
"www.bookyogaretreats.com/all/d/asia-and-oceania/vietnam",
"www.bookyogaretreats.com/all/c/holidays/d/the-americas-and-caribbean",
"www.bookyogaretreats.com/all/c/holidays/d/europe/united-kingdom",
"www.bookyogaretreats.com/all/d/the-americas-and-caribbean/usa/hawaii",
"www.bookyogaretreats.com/?arrival_date=2016-06-15&flexible=15",
"www.bookyogaretreats.com/all/d/europe/united-kingdom/england",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/indonesia/bali",
"www.bookyogaretreats.com/all/d/europe/france",
"www.bookyogaretreats.com/all/c/holidays/d/europe/greece",
"www.bookyogaretreats.com/all/d/europe/greece",
"www.bookyogaretreats.com/?arrival_date=2016-07-15&flexible=15",
"www.bookyogaretreats.com/?arrival_date=2016-10-15&flexible=15",
"www.bookyogaretreats.com/?arrival_date=2016-09-15&flexible=15",
"www.bookyogaretreats.com/all/c/holidays/d/africa-and-the-middle-east/morocco",
"www.bookyogaretreats.com/?arrival_date=2016-11-15&flexible=15",
"www.bookyogaretreats.com/?arrival_date=2017-01-15&flexible=15",
"www.bookyogaretreats.com/all/d/the-americas-and-caribbean",
"www.bookyogaretreats.com/all/d/asia-and-oceania/nepal",
"www.bookyogaretreats.com/all/c/holidays/d/the-americas-and-caribbean/usa/california",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/india/kerala",
"www.bookyogaretreats.com/?arrival_date=2016-08-15&flexible=15",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/thailand",
"www.bookyogaretreats.com/all/d/asia-and-oceania/cambodia",
"www.bookyogaretreats.com/all/d/europe/spain/ibiza",
"www.bookyogaretreats.com/all/c/short/d/the-americas-and-caribbean",
"www.bookyogaretreats.com/all/d/europe/spain/mallorca",
"www.bookyogaretreats.com/all/d/asia-and-oceania/indonesia/bali",
"www.bookyogaretreats.com/all/c/holidays/d/europe/spain/canary-islands",
"www.bookyogaretreats.com/all/c/yoga-surf/d/asia-and-oceania/indonesia/bali",
"www.bookyogaretreats.com/all/d/europe/spain",
"www.bookyogaretreats.com/all/c/holidays/d/europe/spain",
"www.bookyogaretreats.com/all/c/holidays/d/europe/portugal",
"www.bookyogaretreats.com/all/s/ashtanga-yoga",
"www.bookyogaretreats.com/all/d/asia-and-oceania/india/kerala",
"www.bookyogaretreats.com/all/d/europe/italy",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/vietnam",
"www.bookyogaretreats.com/all/d/asia-and-oceania/new-zealand",
"www.bookyogaretreats.com/all/c/holidays/d/the-americas-and-caribbean/usa",
"www.bookyogaretreats.com/all/d/europe",
"www.bookyogaretreats.com/all/d/europe/spain/canary-islands",
"www.bookyogaretreats.com/all/c/holidays/d/europe/spain/ibiza",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/sri-lanka",
"www.bookyogaretreats.com/all/c/holidays/d/the-americas-and-caribbean/costa-rica",
"www.bookyogateachertraining.com/",
"www.bookyogaretreats.com/all/d/asia-and-oceania/australia",
"www.bookyogaretreats.com/?arrival_date=2016-04-15&flexible=15",
"www.bookyogaretreats.com/all/d/the-americas-and-caribbean/USA",
"www.bookyogaretreats.com/all/d/europe/portugal",
"www.bookyogaretreats.com/all/d/asia-and-oceania/sri-lanka",
"www.bookyogaretreats.com",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/cambodia",
"www.bookyogateachertraining.com/all/d/the-americas-and-caribbean",
"www.bookyogaretreats.com/all/d/africa-and-the-middle-east/morocco",
"www.bookyogaretreats.com/all/d/africa-and-the-middle-east",
"www.bookyogaretreats.com/all/d/the-americas-and-caribbean/costa-rica",
"www.bookyogaretreats.com/all/c/holidays/d/asia-and-oceania/australia",
"www.bookyogaretreats.com/all/d/asia-and-oceania/indonesia",
"www.bookyogateachertraining.com/all/d/the-americas-and-caribbean/costa-rica",
"www.bookyogaretreats.com/all/d/europe/united-kingdom",
"www.bookyogaretreats.com/all/d/asia-and-oceania/thailand",
"www.bookyogaretreats.com/all/d/asia-and-oceania"
]

import csv
import codecs

file_name = '20160712.csv'

#setup dictionaries 
basic_dict = {} #destination id: destination name
ready_dict = {} #destination id: 

names = [] #all destination names 
ready_names = [] #all destinations that are not advertised yet
ready_urls = [] #all urls (landing pages) that are not advertised yet
ready_ids = [] #all destinaiton ids that are not advertised yet


#setup basic_dict, names, ready_names, ready_urls, ready_ids
with codecs.open(file_name, 'r', encoding = 'utf-8', errors = 'ignore') as csvfile:
    reader=csv.DictReader(csvfile)
    for row in reader:
        names.append(row['name'])
        basic_dict[int(row['destination_id'])] = row['name']
        if row['concat'] not in done_urls: #only for urls that do not have adgroups yet
            ready_urls.append(row['concat']) #add all urls
            ready_ids.append(int(row['destination_id']))
            ready_names.append(row['name'])

#setup ready_dict 
#['key'] = destination_id
#ready_dict['key'][0] = destination name
#ready_dict['key'][1] = destination type
#ready_dict['key'][2] = number of listings
#ready_dict['key'][3] = URL (landing page)
#ready_dict['key'][4] = country name
#ready_dict['key'][5] = destination slug
#ready_dict['key'][6] = parent slug
with codecs.open(file_name, 'r', encoding = 'utf-8', errors = 'ignore') as csvfile:
    reader=csv.DictReader(csvfile)
    for row in reader:
        if row['concat'] not in done_urls:
            ready_dict[int(row['destination_id'])] = [row['name'], row['type1'], int(row['nr_listings']), row['concat'], row['name2'], row['slug1'], row['slug2'], row['name2'], 'in '+ row['name']]
                                                                                                                        #basic_dict[int(row['parent_id1'])]
######################################################################################################################################################################################################

#prepare text ads
headline1 = []
headline2 = []

desc11 = []
desc12 = []

desc21 = []
desc22 = []

display_url = []
final_url = []

campaign = []
ad_group = []

#create ads
for i in range(len(ready_ids)):
    headline1.append('Book Yoga Retreats Online')
    headline2.append('Best Yoga Retreats 2016')
    
    desc11.append('%s Deals in %s!' %(ready_dict[ready_ids[i]][2], ready_dict[ready_ids[i]][0]))
    desc12.append('Top Rated & Best Price Guarantee')
    
    desc21.append('%s Deals in %s!' %(ready_dict[ready_ids[i]][2], ready_dict[ready_ids[i]][0]))
    desc22.append('Compare and Book from Top Packages')
    
    display_url.append('www.BookYogaRetreats.com/%s' %ready_dict[ready_ids[i]][5].title())
    final_url.append('https://' + ready_dict[ready_ids[i]][3])

    ad_group.append('Longtail Retreats %s' %ready_dict[ready_ids[i]][0])

#assign them to campaigns and ad groups accordingly
for i in range(len(ready_ids)):
    if ready_dict[ready_ids[i]][1] == 'country':
        campaign.append("Longtail %s" %ready_dict[ready_ids[i]][0])
    if ready_dict[ready_ids[i]][1] == 'state':
        campaign.append("Longtail %s - %s" %(ready_dict[ready_ids[i]][4], ready_dict[ready_ids[i]][0]))
    
for i in range(len(ad_group)):
    ad_group[i] = ad_group[i].replace("  ", " ")
    campaign[i] = campaign[i].replace("  ", " ")

#set up display urls
for i in range(len(display_url)):
    display_url[i] = display_url[i].replace('-', '')
    if len(display_url[i]) > 35:
        display_url[i] = 'www.BookYogaRetreats.com'

#character limit checking
for item in headline1:
    if len(item) > 25:
        print(item)
        
for item in headline2:
    if len(item) > 25:
        print(item)

for i in range(len(desc11)):
    if len(desc11[i]) > 38:
        desc11[i] = ''.join([i for i in desc11[i] if not i.isdigit()])
        desc11[i] = desc11[i].replace(' Deals', 'Deals')
        if len(desc11[i]) > 38:
            desc11[i] = desc11[i].replace("Deals in ", '')

for i in range(len(desc11)):
    if len(desc11[i]) > 38:
        print(desc11[i], len(desc11[i]))
    
for i in range(len(desc21)):
    if len(desc21[i]) > 38:
        desc21[i] = ''.join(i for i in desc21[i] if not i.isdigit())
        desc21[i] = desc21[i].replace(' Deals', 'Deals')
        if len(desc21[i]) > 38:
            desc21[i] = desc21[i].replace('Deals in ', '')
            
for i in range(len(desc21)):
    if len(desc21[i]) > 38:
        print(desc21[i], len(desc21[i]))

#prepare to export  
headlines = (headline1 + headline2) * 2
d1 = (desc11 + desc21) * 2
d2 = (desc12 + desc22) * 2

display_url = display_url * 4
final_url = final_url * 4
campaign = campaign * 4
ad_group = ad_group * 4

how_many_ads = len(headlines)

ad_state = ['enabled'] * how_many_ads
ad_type = ['Text ad'] * how_many_ads

dev_all = ['All'] * int(how_many_ads/2)
dev_mobile = ['Mobile'] * int(how_many_ads/2)
dev_pref = dev_all + dev_mobile

ad_column_titles = ["Ad state",
                    "Ad",
                    "Description line 1",
                    "Description line 2",
                    "Display URL",
                    "Final URL",
                    "Device preference type",
                    "Campaign",
                    "Ad group",
                    "Ad type"] 

ad_rows = []

for i in range(how_many_ads):
    ad_rows.append(
        [ad_state[i],
        headlines[i],
        d1[i],
        d2[i],
        display_url[i],
        final_url[i],
        dev_pref[i],
        campaign[i],
        ad_group[i],
        ad_type[i]])        

export_name = 'SQL_ads.csv'
new_export = open(export_name, 'w')
export_object = csv.writer(new_export)

export_object.writerow(ad_column_titles)
export_object.writerows(ad_rows)

new_export.close()

print('%i ads for %i destinations have been created (4 ads per destination: 2 for mobile, 2 for desktop) please check your current directory for the csv output' %(len(d1), len(ready_urls)))

######################################################################################################################################################################################################

#prepare keywords
yoga = ['yoga']
        
holiday_word1 = [
'training',
'trainings', 
'retreat',  
'retreats', 
'vacation',
'vacations',
'resort',
'resorts',
'camp',
'camps',
'package',
'packages',
'center',
'centers',
'centre',
'centres',
'deal',
'deals']

holiday_word2 = [
'package',
'packages',
'resort',
'resorts',
'retreat',
'retreats',
'deal',
'deals',
'']

#prepare destinations
destination_front = []
destination_back= []

for i in range(len(ready_ids)):
    destination_front.append(str(ready_ids[i]))
    destination_back.append(str(ready_ids[i]))
    destination_back.append(str(ready_ids[i]))
    
a1 = [yoga, holiday_word1, holiday_word2, destination_back]
a2 = [destination_front, yoga, holiday_word1, holiday_word2]

#generate keywords
import itertools

comb = list(itertools.product(*a1))
comb2 = list(itertools.product(*a2))

for i in range(len(comb)):
    if comb[i][1] == comb[i][2]:
        comb[i] = (comb[i][0], comb[i][1], comb[i][3])
    elif comb[i][1]+'s' == comb[i][2]:
        comb[i] = (comb[i][0], comb[i][1], comb[i][3])
    elif comb[i][1] == comb[i][2]+'s':
        comb[i] = (comb[i][0], comb[i][1], comb[i][3])
    
for i in range(len(comb2)):
    if comb2[i][2] == comb2[i][3]:
        comb2[i] = (comb2[i][0], comb2[i][1], comb2[i][2])
    elif comb2[i][2]+'s' == comb2[i][3]:
        comb2[i] = (comb2[i][0], comb2[i][1], comb2[i][2])
    elif comb2[i][2] == comb2[i][3]+'s':
        comb2[i] = (comb2[i][0], comb2[i][1], comb2[i][2])
        
results = []

kw_campaign = []
kw_ad_group = []

keyword_max_cpc = []

for i in range(len(comb)):
    if ready_dict[int(comb[i][-1])][1] == 'state':
        kw_campaign.append("Longtail %s - %s" %(ready_dict[int(comb[i][-1])][-2], ready_dict[int(comb[i][-1])][0]))
        kw_ad_group.append("Longtail Retreats %s" %ready_dict[int(comb[i][-1])][0])

    elif ready_dict[int(comb[i][-1])][1] == 'country':
        kw_campaign.append("Longtail %s" %ready_dict[int(comb[i][-1])][0])
        kw_ad_group.append("Longtail Retreats %s" %ready_dict[int(comb[i][-1])][0])

    #assign max_cpc according to number of listings
    if ready_dict[int(comb[i][-1])][2] < 6:
        keyword_max_cpc.append(0.20)
    elif ready_dict[int(comb[i][-1])][2] < 11:
        keyword_max_cpc.append(0.25)
    elif ready_dict[int(comb[i][-1])][2] < 21:
        keyword_max_cpc.append(0.30)
    elif ready_dict[int(comb[i][-1])][2] < 31:
        keyword_max_cpc.append(0.35)
    elif ready_dict[int(comb[i][-1])][2] < 41:
        keyword_max_cpc.append(0.40)
    elif ready_dict[int(comb[i][-1])][2] < 51:
        keyword_max_cpc.append(0.45)
    elif ready_dict[int(comb[i][-1])][2] < 101:
        keyword_max_cpc.append(0.50)
    elif ready_dict[int(comb[i][-1])][2] < 151:
        keyword_max_cpc.append(0.55)
    elif ready_dict[int(comb[i][-1])][2] < 201:
        keyword_max_cpc.append(0.60)
    elif ready_dict[int(comb[i][-1])][2] < 251:
        keyword_max_cpc.append(0.70)
    elif ready_dict[int(comb[i][-1])][2] < 301:
        keyword_max_cpc.append(0.80)
    elif ready_dict[int(comb[i][-1])][2] < 501:
        keyword_max_cpc.append(0.90)
    else:
        keyword_max_cpc.append(0.90)

    comb[i] = list(comb[i])
    
    if i%2 == 1: #odd
        comb[i][-1] = ready_dict[int(comb[i][-1])][-1] #id -> name
    if i%2 == 0: #even
        comb[i][-1] = ready_dict[int(comb[i][-1])][0] #id -> name

    comb[i] = tuple(x for x in comb[i] if x != '')
    comb[i] = '[' + (' '.join(comb[i])) + ']'

for i in range(len(comb2)):
    if ready_dict[int(comb2[i][0])][1] == 'state':
        kw_campaign.append("Longtail %s - %s" %(ready_dict[int(comb2[i][0])][-2], ready_dict[int(comb2[i][0])][0]))
        kw_ad_group.append("Longtail Retreats %s" %ready_dict[int(comb2[i][0])][0])
        
    elif ready_dict[int(comb2[i][0])][1] == 'country':
        kw_campaign.append("Longtail %s" %ready_dict[int(comb2[i][0])][0])
        kw_ad_group.append("Longtail Retreats %s" %ready_dict[int(comb2[i][0])][0])
    
    #assign max_cpc depending on number of listings     
    if ready_dict[int(comb2[i][0])][2] < 6:
        keyword_max_cpc.append(0.20)
    elif ready_dict[int(comb2[i][0])][2]< 11:
        keyword_max_cpc.append(0.25)
    elif ready_dict[int(comb2[i][0])][2] < 21:
        keyword_max_cpc.append(0.30)
    elif ready_dict[int(comb2[i][0])][2] < 31:
        keyword_max_cpc.append(0.35)
    elif ready_dict[int(comb2[i][0])][2] < 41:
        keyword_max_cpc.append(0.40)
    elif ready_dict[int(comb2[i][0])][2] < 51:
        keyword_max_cpc.append(0.45)
    elif ready_dict[int(comb2[i][0])][2] < 101:
        keyword_max_cpc.append(0.50)
    elif ready_dict[int(comb2[i][0])][2] < 151:
        keyword_max_cpc.append(0.55)
    elif ready_dict[int(comb2[i][0])][2] < 201:
        keyword_max_cpc.append(0.60)
    elif ready_dict[int(comb2[i][0])][2] < 251:
        keyword_max_cpc.append(0.70)
    elif ready_dict[int(comb2[i][0])][2] < 301:
        keyword_max_cpc.append(0.80)
    elif ready_dict[int(comb2[i][0])][2] < 501:
        keyword_max_cpc.append(0.90)
    else:
        keyword_max_cpc.append(0.90)
        
    comb2[i] = list(comb2[i])
    
    comb2[i][0] = ready_dict[int(comb2[i][0])][0]

    comb2[i] = tuple(x for x in comb2[i] if x != '')
    comb2[i] = '[' + (' '.join(comb2[i])) +']'
    
results = comb + comb2

for i in range(len(results)):
    results[i] = results[i].replace(',', '')
    results[i] = results[i].replace('-', ' ')

#prepare to export csv
ad_group_max_cpc = [0.10]
keyword_state = ['enabled'] * len(results)
match_type = ['Exact'] * len(results)
ad_group_max_cpc = ad_group_max_cpc * len(results)

kw_column_titles = ['Keyword state',
                   'Keyword',
                   'Match type',
                   'Campaign',
                   'Ad group',
                   'Keyword max CPC',
                   'Ad group max CPC']

kw_rows = []
for i in range(len(results)):
    kw_rows.append([keyword_state[i],
                  results[i],
                  match_type[i],
                  kw_campaign[i],
                  kw_ad_group[i],
                  keyword_max_cpc[i],
                  ad_group_max_cpc[i]])
    
for i in range(len(kw_rows)):
    kw_rows[i] = tuple(kw_rows[i])
    
kw_rows = set(kw_rows)

import math

limit = 19994
cut = math.ceil(len(results) / limit)

if len(results) > limit:
    for i in range(cut):
        export_name = 'SQL_kws_%i.csv' %(i+1)
        new_export = open(export_name, 'w')
        export_object = csv.writer(new_export)

        export_object.writerow(kw_column_titles)
        export_object.writerows(kw_rows[0:limit*(i+1)])
        new_export.close()


#export_name = 'SQL_kws.csv'
#new_export = open(export_name, 'w')
#export_object = csv.writer(new_export)

# export_object.writerow(kw_column_titles)
# export_object.writerows(kw_rows)

# new_export.close()

print('%i keywords for %i destinations have been created in %i file(s) please check your current directory for the csv output' %(len(results), len(ready_urls), len(cut)))

# ######################################################################################################################################################################################################

# #split csv by 19994 rows per file (adwords bulk upload maximum limit)
# import os

# def split(filehandler, delimiter=',', row_limit=19994, 
#     output_name_template='SQL_kws_%s.csv', output_path='.', keep_headers=True):
#     """
#     Splits a CSV file into multiple pieces.
    
#     A quick bastardization of the Python CSV library.
#     Arguments:
#         `row_limit`: The number of rows you want in each output file. 19994 by default.
#         `output_name_template`: A %s-style template for the numbered output files.
#         `output_path`: Where to stick the output files.
#         `keep_headers`: Whether or not to print the headers in each output file.
#     Example usage:
    
#         >> from toolbox import csv_splitter;
#         >> csv_splitter.split(open('/home/ben/input.csv', 'r'));
    
#     """
#     import csv
#     reader = csv.reader(filehandler, delimiter=delimiter)
#     current_piece = 1
#     current_out_path = os.path.join(
#          output_path,
#          output_name_template  % current_piece
#     )
#     current_out_writer = csv.writer(open(current_out_path, 'w'), delimiter=delimiter)
#     current_limit = row_limit
#     if keep_headers:
#         headers = reader.__next__()
#         current_out_writer.writerow(headers)
#     for i, row in enumerate(reader):
#         if i + 1 > current_limit:
#             current_piece += 1
#             current_limit = row_limit * current_piece
#             current_out_path = os.path.join(
#                output_path,
#                output_name_template  % current_piece
#             )
#             current_out_writer = csv.writer(open(current_out_path, 'w'), delimiter=delimiter)
#             if keep_headers:
#                 current_out_writer.writerow(headers)
#         current_out_writer.writerow(row)

# if len(results) > 19994:
#     split(open(export_name), 'r')
#     print('SQL_kw csv file has been split into multiple files, each including 19994 keywords please check your current directory for the output csv files')